<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>De Boel de Boel Tocht - Den Bosch Pub Crawl</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Fredoka:wght@400;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Fredoka', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); height: 100vh; overflow: hidden; }
        .login-container { display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .login-box { background: linear-gradient(135deg, #C41E3A 0%, #FF6B6B 50%, #FFA500 100%); padding: 50px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); text-align: center; max-width: 400px; }
        .login-box h1 { font-family: 'Fredoka One', cursive; font-size: 42px; color: white; margin-bottom: 20px; text-shadow: 3px 3px 0 rgba(0,0,0,0.3); }
        .login-box p { color: white; margin-bottom: 30px; font-size: 16px; }
        .login-box input { width: 100%; padding: 15px; margin-bottom: 15px; border: 2px solid white; border-radius: 8px; font-size: 16px; font-family: 'Fredoka', sans-serif; background: rgba(255,255,255,0.9); }
        .login-box button { width: 100%; padding: 15px; background: white; color: #C41E3A; border: none; border-radius: 8px; font-size: 16px; font-weight: 700; cursor: pointer; font-family: 'Fredoka', sans-serif; text-transform: uppercase; }
        .error-message { color: #fff; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; margin-bottom: 15px; display: none; font-size: 14px; }
        .container { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .header { background: linear-gradient(135deg, #C41E3A 0%, #FF6B6B 50%, #FFA500 100%); color: white; padding: 25px; text-align: center; box-shadow: 0 8px 32px rgba(196, 30, 58, 0.4); border-bottom: 4px solid #FFD700; position: relative; z-index: 100; }
        .header h1 { font-family: 'Fredoka One', cursive; font-size: 42px; margin-bottom: 8px; text-shadow: 3px 3px 0 rgba(0,0,0,0.3); }
        .header-subtitle { font-size: 16px; opacity: 0.95; }
        .progress-bar { position: absolute; bottom: 0; left: 0; height: 4px; background: #FFD700; transition: width 0.5s ease; width: 0%; }
        .content { display: flex; flex: 1; gap: 0; overflow: hidden; }
        #map { flex: 1; background: #e8eef5; position: relative; overflow: hidden; }
        .fullscreen-btn { position: absolute; top: 10px; right: 10px; background: white; border: 2px solid #C41E3A; border-radius: 6px; padding: 10px 15px; font-size: 18px; cursor: pointer; z-index: 999; transition: all 0.3s; font-weight: bold; color: #C41E3A; }
        .fullscreen-btn:hover { background: #C41E3A; color: white; transform: scale(1.1); }
        #map.fullscreen { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 10000; flex: none; }
        .container.fullscreen-mode .header { display: none; }
        .container.fullscreen-mode .sidebar { display: none; }
        .container.fullscreen-mode .content { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; }
        .fullscreen-btn::before { content: '‚õ∂ '; }
        .fullscreen-btn.exit::before { content: '‚úï '; }
        .sidebar { width: 320px; background: white; display: flex; flex-direction: column; box-shadow: -4px 0 16px rgba(0,0,0,0.2); overflow: hidden; }
        .sidebar-header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: white; padding: 20px; border-bottom: 3px solid #C41E3A; }
        .sidebar-header h2 { font-family: 'Fredoka One', cursive; font-size: 20px; margin-bottom: 10px; }
        .stats { display: flex; gap: 15px; font-size: 13px; }
        .stat { flex: 1; text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; }
        .stat-number { font-weight: 700; font-size: 18px; color: #FFD700; display: block; }
        .stat-label { font-size: 11px; opacity: 0.8; }
        .legend-container { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 20px; min-height: 0; background: white; }
        .area-group { margin-bottom: 25px; }
        .area-name { font-family: 'Fredoka One', cursive; font-weight: 700; padding: 10px 14px; border-radius: 8px; margin-bottom: 12px; color: white; font-size: 13px; text-transform: uppercase; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 10px; }
        .area-name::before { content: ''; width: 12px; height: 12px; border-radius: 50%; background: white; flex-shrink: 0; }
        .area-name.red { background: linear-gradient(135deg, #E63946 0%, #C41E3A 100%); }
        .area-name.white { background: linear-gradient(135deg, #555555 0%, #333333 100%); }
        .area-name.yellow { background: linear-gradient(135deg, #F4A460 0%, #FF8C42 100%); }
        .area-name.green { background: linear-gradient(135deg, #32CD32 0%, #228B22 100%); }
        .pub-item { padding: 12px 14px; margin-bottom: 8px; border-left: 4px solid; border-radius: 6px; font-size: 13px; cursor: pointer; transition: all 0.3s; background: rgba(0,0,0,0.03); display: flex; align-items: center; gap: 10px; }
        .pub-item:hover { transform: translateX(6px); background: rgba(0,0,0,0.06); }
        .pub-item.red { border-left-color: #E63946; }
        .pub-item.white { border-left-color: #333; }
        .pub-item.yellow { border-left-color: #F4A460; }
        .pub-item.green { border-left-color: #32CD32; }
        .pub-item.completed { background: rgba(76, 175, 80, 0.1); border-left-color: #4CAF50; opacity: 0.7; }
        .pub-number { display: inline-flex; align-items: center; justify-content: center; min-width: 24px; height: 24px; background: rgba(0,0,0,0.08); border-radius: 4px; font-size: 12px; font-weight: 700; flex-shrink: 0; }
        .pub-item.red .pub-number { color: #E63946; }
        .pub-item.white .pub-number { color: #333; }
        .pub-item.yellow .pub-number { color: #F4A460; }
        .pub-item.green .pub-number { color: #32CD32; }
        .pub-item.completed .pub-number { background: #4CAF50; color: white; }
        .pub-name { flex: 1; }
        .checkbox { width: 20px; height: 20px; border: 2px solid currentColor; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: #999; flex-shrink: 0; }
        .pub-item.completed .checkbox { background: #4CAF50; color: white; border-color: #4CAF50; }
        .reset-button { padding: 10px 14px; margin: 15px 20px; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; text-transform: uppercase; }
        .leaflet-marker-icon { background: transparent !important; border: none !important; box-shadow: none !important; }
        #returningClientInfo { margin-bottom: 15px; }
        @media (max-width: 768px) {
            body { height: auto; overflow: auto; }
            .container { height: auto; overflow: auto; }
            .content { flex-direction: column; height: auto; overflow: auto; }
            .sidebar { width: 100%; flex: none; height: auto; overflow: visible; }
            #map { flex: none; width: 100%; height: 250px; }
            .legend-container { height: auto; overflow: visible; }
        }
        @media (max-width: 480px) {
            #map { height: 200px; }
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h1>üç∫ Boel de boel kroegentocht 2026 üç∫</h1>
            <p>Enter the password to access the pub crawl tracker</p>
            <div class="error-message" id="errorMessage">Incorrect password, try again!</div>
            <input type="password" id="passwordInput" placeholder="Enter password" />
            <button onclick="window.checkPassword()">Access Tracker</button>
        </div>
    </div>

    <div class="container" id="app" style="display: none;">
        <div class="header">
            <div class="header-content">
                <h1>üç∫ Boel de boel kroegentocht 2026 üç∫</h1>
                <p class="header-subtitle">De enige √©chte kroegentocht van Oeteldonk</p>
            </div>
            <div class="progress-bar"></div>
        </div>
        
        <div class="content" id="content">
            <div id="map">
                <button class="fullscreen-btn" id="fullscreenBtn" onclick="window.toggleMapFullscreen()"></button>
            </div>
            
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>Your Progress</h2>
                    <div class="stats">
                        <div class="stat"><span class="stat-number" id="completed">0</span><span class="stat-label">Completed</span></div>
                        <div class="stat"><span class="stat-number" id="remaining">13</span><span class="stat-label">Remaining</span></div>
                        <div class="stat"><span class="stat-number" id="percentage">0%</span><span class="stat-label">Progress</span></div>
                    </div>
                </div>
                
                <div class="legend-container" id="legendContainer">
                    <div class="area-group">
                        <div class="area-name red">üî¥ Red Area</div>
                        <div class="pub-item red" data-id="1"><div class="pub-number">1</div><div class="pub-name">Reinders</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item red" data-id="2"><div class="pub-number">2</div><div class="pub-name">Het Veulen</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item red" data-id="3"><div class="pub-number">3</div><div class="pub-name">Bar 35</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item red" data-id="4"><div class="pub-number">4</div><div class="pub-name">Dit</div><div class="checkbox">‚úì</div></div>
                    </div>
                    <div class="area-group">
                        <div class="area-name white">‚ö™ White Area</div>
                        <div class="pub-item white" data-id="5"><div class="pub-number">5</div><div class="pub-name">Jheronimus</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item white" data-id="6"><div class="pub-number">6</div><div class="pub-name">Plaats Royaal</div><div class="checkbox">‚úì</div></div>
                    </div>
                    <div class="area-group">
                        <div class="area-name yellow">üü° Yellow Area</div>
                        <div class="pub-item yellow" data-id="7"><div class="pub-number">7</div><div class="pub-name">Bar Boas</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item yellow" data-id="8"><div class="pub-number">8</div><div class="pub-name">Bij Dirk</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item yellow" data-id="9"><div class="pub-number">9</div><div class="pub-name">Eetbar de Stadt</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item yellow" data-id="10"><div class="pub-number">10</div><div class="pub-name">Pantoffeltje</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item yellow" data-id="11"><div class="pub-number">11</div><div class="pub-name">Het Hart</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item yellow" data-id="12"><div class="pub-number">12</div><div class="pub-name">Bonte Pallet</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item yellow" data-id="13"><div class="pub-number">13</div><div class="pub-name">Baron's Lodge</div><div class="checkbox">‚úì</div></div>
                    </div>
                    <div style="font-family: 'Fredoka One'; font-size: 11px; color: #999; margin-top: 15px; text-transform: uppercase; font-weight: 700;">üåü Bonus Pubs (Optional)</div>
                    <div class="area-group">
                        <div class="area-name green">üíö Outsiders</div>
                        <div class="pub-item green" data-id="14"><div class="pub-number">‚òÖ</div><div class="pub-name">O'Mearas Irish Pub</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item green" data-id="15"><div class="pub-number">‚òÖ</div><div class="pub-name">Caf√© de Palm</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item green" data-id="16"><div class="pub-number">‚òÖ</div><div class="pub-name">De Raadskelder</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item green" data-id="17"><div class="pub-number">‚òÖ</div><div class="pub-name">Hello my Friend!</div><div class="checkbox">‚úì</div></div>
                        <div class="pub-item green" data-id="18"><div class="pub-number">‚òÖ</div><div class="pub-name">Paternoster</div><div class="checkbox">‚úì</div></div>
                    </div>
                </div>
                <button class="reset-button" id="resetBtn" type="button">‚Üª Reset Progress</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script>
        let pubs = [], markers = {}, completed = [], mapInitialized = false;
        
        window.checkPassword = function() {
            const PASSWORD = 'zootjeongeregeld2026';
            const passwordInput = document.getElementById('passwordInput').value;
            const errorMessage = document.getElementById('errorMessage');
            if (passwordInput === PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                sessionStorage.setItem('boelBoelAuth', 'true');
                window.initializeMap();
            } else {
                errorMessage.style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        };
        
        window.triggerConfetti = function() {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            setTimeout(() => {
                confetti({
                    particleCount: 50,
                    spread: 100,
                    origin: { y: 0.6 }
                });
            }, 300);
        };
        
        window.toggleMapFullscreen = function() {
            const mapDiv = document.getElementById('map');
            const container = document.getElementById('app');
            const btn = document.getElementById('fullscreenBtn');
            if (mapDiv.classList.contains('fullscreen')) {
                mapDiv.classList.remove('fullscreen');
                container.classList.remove('fullscreen-mode');
                btn.classList.remove('exit');
            } else {
                mapDiv.classList.add('fullscreen');
                container.classList.add('fullscreen-mode');
                btn.classList.add('exit');
            }
            setTimeout(() => {
                if (window.mapInstance) window.mapInstance.invalidateSize(true);
            }, 100);
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') window.checkPassword();
            });
            
            // Setup reset button
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    completed = [];
                    localStorage.setItem('boelBoelCompleted', JSON.stringify(completed));
                    
                    // Update all markers
                    if (mapInitialized && pubs.length > 0) {
                        pubs.forEach(pub => {
                            if (markers[pub.id]) {
                                const icon = L.divIcon({
                                    html: `<div style="background-color: ${pub.color}; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; border: 3px solid white; box-shadow: 0 3px 12px rgba(0,0,0,0.3); font-family: 'Fredoka One';">${pub.id}</div>`,
                                    iconSize: [40, 40]
                                });
                                markers[pub.id].setIcon(icon);
                                const popupContent = `<div><h3 style="color: ${pub.color};">${pub.id}. ${pub.name}</h3><p><strong>Area:</strong> <span style="color: ${pub.color};">${pub.area.toUpperCase()}</span></p><p><strong>Status:</strong> <span style="color: #F44336;">Not visited</span></p><div style="margin-top: 10px;"><button data-pubid="${pub.id}" class="mark-complete-btn" style="width: 100%; padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">Mark Complete</button></div></div>`;
                                markers[pub.id].setPopupContent(popupContent);
                            }
                        });
                    }
                    
                    // Update UI
                    document.getElementById('completed').textContent = '0/13';
                    document.getElementById('remaining').textContent = '13';
                    document.getElementById('percentage').textContent = '0%';
                    document.querySelector('.progress-bar').style.width = '0%';
                    
                    document.querySelectorAll('.pub-item').forEach(item => {
                        item.classList.remove('completed');
                    });
                });
            }
        });
        
        window.initializeMap = function() {
            if (mapInitialized) return;
            mapInitialized = true;
            const map = L.map('map').setView([51.6884, 5.3048], 15);
            window.mapInstance = map;
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap', maxZoom: 19 }).addTo(map);
            
            pubs = [
                { id: 1, name: 'Reinders', lat: 51.689658892634846, lng: 5.300710010940677, area: 'red', color: '#E63946', required: true },
                { id: 2, name: 'Het Veulen', lat: 51.68977209647595, lng: 5.300141446566025, area: 'red', color: '#E63946', required: true },
                { id: 3, name: 'Dit', lat: 51.68832490600335, lng: 5.301377522075502, area: 'red', color: '#E63946', required: true },
                { id: 4, name: 'Jheronimus', lat: 51.68890144131806, lng: 5.303285633408725, area: 'white', color: '#555555', required: true },
                { id: 5, name: 'Plaats Royaal', lat: 51.688007195275574, lng: 5.303759927835246, area: 'white', color: '#555555', required: true },
                { id: 6, name: '\'t Stokpaardje', lat: 51.688101510672595, lng: 5.304668582046056, area: 'white', color: '#555555', required: true },
                { id: 7, name: 'Bar Boas', lat: 51.68770346620766, lng: 5.30731419542771, area: 'yellow', color: '#F4A460', required: true },
                { id: 8, name: 'Bij Dirk', lat: 51.68643255969921, lng: 5.305761098615981, area: 'yellow', color: '#F4A460', required: true },
                { id: 9, name: 'Eetbar de Stadt', lat: 51.68703937186069, lng: 5.305199444249146, area: 'yellow', color: '#F4A460', required: true },
                { id: 10, name: 'Pantoffeltje', lat: 51.68761537096449, lng: 5.305789351736798, area: 'yellow', color: '#F4A460', required: true },
                { id: 11, name: 'Het Hart', lat: 51.68777044650596, lng: 5.307282186244409, area: 'yellow', color: '#F4A460', required: true },
                { id: 12, name: 'Bonte Pallet', lat: 51.6887586929537, lng: 5.308105723090129, area: 'yellow', color: '#F4A460', required: true },
                { id: 13, name: 'Caf√© De Smidse', lat: 51.68849543026497, lng: 5.307797939534354, area: 'yellow', color: '#F4A460', required: true },
                { id: 14, name: 'Stadscaf√© de Basiliek', lat: 51.68877725806452, lng: 5.307745139848, area: 'yellow', color: '#F4A460', required: true },
                { id: 15, name: 'Baron\'s Lodge', lat: 51.6871376862583, lng: 5.305960825286391, area: 'yellow', color: '#F4A460', required: true },
                { id: 16, name: 'O\'Mearas Irish Pub', lat: 51.68889799946857, lng: 5.301137668484566, area: 'green', color: '#32CD32', required: false },
                { id: 17, name: 'Caf√© de Palm', lat: 51.68878809199506, lng: 5.309014070013813, area: 'green', color: '#32CD32', required: false },
                { id: 18, name: 'De Raadskelder', lat: 51.688507325839424, lng: 5.303281077607486, area: 'green', color: '#32CD32', required: false },
                { id: 19, name: 'Hello my Friend!', lat: 51.689839348996884, lng: 5.3007707436085205, area: 'green', color: '#32CD32', required: false },
                { id: 20, name: 'Bar 35', lat: 51.689901550279856, lng: 5.299624028090119, area: 'green', color: '#32CD32', required: false },
                { id: 21, name: 'Paternoster', lat: 51.68906730633433, lng: 5.303330878792206, area: 'green', color: '#32CD32', required: false }
            ];
            
            completed = JSON.parse(localStorage.getItem('boelBoelCompleted')) || [];
            
            function createIcon(pub) {
                const isCompleted = completed.includes(pub.id);
                const bgColor = isCompleted ? '#4CAF50' : pub.color;
                const icon = isCompleted ? '‚úì' : pub.id;
                return L.divIcon({
                    html: `<div style="background-color: ${bgColor}; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; border: 3px solid white; box-shadow: 0 3px 12px rgba(0,0,0,0.3); font-family: 'Fredoka One';">${icon}</div>`,
                    iconSize: [40, 40]
                });
            }
            
            pubs.forEach(pub => {
                const marker = L.marker([pub.lat, pub.lng], { icon: createIcon(pub) }).addTo(map);
                markers[pub.id] = marker;
                const isCompleted = completed.includes(pub.id);
                const popupContent = `<div><h3 style="color: ${pub.color};">${pub.id}. ${pub.name}</h3><p><strong>Area:</strong> <span style="color: ${pub.color};">${pub.area.toUpperCase()}</span></p><p><strong>Status:</strong> <span style="color: ${isCompleted ? '#4CAF50' : '#F44336'};">${isCompleted ? '‚úì Completed' : 'Not visited'}</span></p><div style="margin-top: 10px;"><button data-pubid="${pub.id}" class="mark-complete-btn" style="width: 100%; padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">${isCompleted ? 'Unmark' : 'Mark Complete'}</button></div></div>`;
                marker.bindPopup(popupContent, {
                    closeButton: true,
                    autoClose: false
                });
            });
            
            document.querySelectorAll('.pub-item').forEach(item => {
                item.addEventListener('click', function() {
                    window.togglePub(parseInt(this.dataset.id));
                });
            });
            
            // Event delegation for popup buttons - use document level
            document.addEventListener('click', function(e) {
                if (e.target && e.target.classList.contains('mark-complete-btn')) {
                    const pubId = parseInt(e.target.getAttribute('data-pubid'));
                    window.togglePub(pubId);
                }
            }, true);
            
            const allBounds = L.latLngBounds(pubs.map(p => [p.lat, p.lng]));
            map.fitBounds(allBounds, { padding: [50, 50] });
            window.updateUI();
        };
        
        window.togglePub = function(id) {
            const index = completed.indexOf(id);
            if (index > -1) {
                completed.splice(index, 1);
            } else {
                completed.push(id);
            }
            localStorage.setItem('boelBoelCompleted', JSON.stringify(completed));
            window.updateUI();
            if (markers[id]) {
                const pub = pubs.find(p => p.id === id);
                const isCompleted = completed.includes(id);
                
                const bgColor = isCompleted ? '#4CAF50' : pub.color;
                const icon = isCompleted ? '‚úì' : pub.id;
                markers[id].setIcon(L.divIcon({
                    html: `<div style="background-color: ${bgColor}; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; border: 3px solid white; box-shadow: 0 3px 12px rgba(0,0,0,0.3); font-family: 'Fredoka One';">${icon}</div>`,
                    iconSize: [40, 40]
                }));
                
                const popupContent = `<div><h3 style="color: ${pub.color};">${pub.id}. ${pub.name}</h3><p><strong>Area:</strong> <span style="color: ${pub.color};">${pub.area.toUpperCase()}</span></p><p><strong>Status:</strong> <span style="color: ${isCompleted ? '#4CAF50' : '#F44336'};">${isCompleted ? '‚úì Completed' : 'Not visited'}</span></p><div style="margin-top: 10px;"><button data-pubid="${pub.id}" class="mark-complete-btn" style="width: 100%; padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">${isCompleted ? 'Unmark' : 'Mark Complete'}</button></div></div>`;
                markers[id].setPopupContent(popupContent);
            }
        };
        
        window.updateUI = function() {
            const requiredPubs = pubs.filter(p => p.required);
            const requiredCompleted = completed.filter(id => pubs.find(p => p.id === id && p.required)).length;
            const bonusCompleted = completed.filter(id => pubs.find(p => p.id === id && !p.required)).length;
            const percentage = Math.round((requiredCompleted / requiredPubs.length) * 100);
            document.getElementById('completed').textContent = `${requiredCompleted}/${requiredPubs.length}${bonusCompleted > 0 ? ` +${bonusCompleted}` : ''}`;
            document.getElementById('remaining').textContent = requiredPubs.length - requiredCompleted;
            document.getElementById('percentage').textContent = percentage + '%';
            document.querySelector('.progress-bar').style.width = Math.min(percentage, 100) + '%';
            document.querySelectorAll('.pub-item').forEach(item => {
                const id = parseInt(item.dataset.id);
                if (completed.includes(id)) {
                    item.classList.add('completed');
                } else {
                    item.classList.remove('completed');
                }
            });
            
            // Trigger confetti when all required pubs are completed
            if (requiredCompleted === requiredPubs.length && requiredCompleted > 0) {
                window.triggerConfetti();
            }
        };
    </script>
</body>
</html>
